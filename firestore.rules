rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /scores/{scoreId} {
      // Anyone can read the high scores
      allow read: if true;

      // Only allow creating a score if:
      // 1. Data types are correct (score is number, name/signature are strings)
      // 2. Name is not empty and not too long
      // 3. Signature field is present (enforces our client-side anti-cheat structure)
      // 4. Score is not obscenely high (sanity check, e.g. < 50000)
      allow create: if request.resource.data.score is number
                    && request.resource.data.name is string
                    && request.resource.data.name.size() > 0
                    && request.resource.data.name.size() <= 15
                    && request.resource.data.signature is string
                    && request.resource.data.score < 50000;

      // Scores are permanent (no update or delete allowed by public clients)
      allow update, delete: if false;
    }
  }
}
